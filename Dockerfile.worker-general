FROM oven/bun:1
WORKDIR /app

# Install deps
COPY package.json bun.lock ./
RUN bun install --frozen-lockfile

# Copy source
COPY . .

# Build worker bundle (optional; we can also run via tsx)
RUN bun run worker:build || true

# Defaults: general worker binding
ENV SEOA_QUEUE_NAME=seo_jobs.general
ENV SEOA_BINDING_KEY=discovery.*,score.*,plan.*,generate.*,publish.*,metrics.*,serp.*,competitors.*,enrich.*,feedback.*

CMD ["bun", "x", "tsx", "src/worker/index.ts"]

