FROM mcr.microsoft.com/playwright:v1.45.0-jammy
WORKDIR /app

# Install bun
ENV BUN_INSTALL=/root/.bun
ENV PATH=/root/.bun/bin:$PATH
RUN apt-get update && apt-get install -y curl ca-certificates && rm -rf /var/lib/apt/lists/* \
  && curl -fsSL https://bun.sh/install | bash

# Install deps
COPY package.json bun.lock ./
RUN bun install --frozen-lockfile

# Copy source
COPY . .

# Defaults: crawler worker binding
ENV SEOA_QUEUE_NAME=seo_jobs.crawler
ENV SEOA_BINDING_KEY=crawl.*

CMD ["bun", "x", "tsx", "src/worker/index.ts"]

